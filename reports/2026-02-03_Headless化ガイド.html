<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clawdboté‹ç”¨ã®HeadlessåŒ–ï¼ˆGUIä¸è¦åŒ–ï¼‰ã‚¬ã‚¤ãƒ‰ - KTè‰¦éšŠ</title>
    <style>
        :root { --bg: #0d1117; --text: #c9d1d9; --accent: #58a6ff; --gold: #ffd700; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); max-width: 900px; margin: 0 auto; padding: 2rem; line-height: 1.8; }
        h1, h2, h3 { color: var(--gold); }
        a { color: var(--accent); }
        pre { background: #161b22; padding: 1rem; border-radius: 8px; overflow-x: auto; }
        code { background: #161b22; padding: 0.2rem 0.4rem; border-radius: 4px; }
        blockquote { border-left: 3px solid var(--accent); padding-left: 1rem; color: #8b949e; }
        table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        th, td { padding: 0.5rem; border: 1px solid #30363d; }
        th { background: #161b22; }
        .back { margin-bottom: 1rem; }
        .back a { padding: 0.5rem 1rem; background: #21262d; border-radius: 6px; text-decoration: none; }
    </style>
</head>
<body>
    <div class="back"><a href="/">â† ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a></div>
<h1>Clawdboté‹ç”¨ã®HeadlessåŒ–ï¼ˆGUIä¸è¦åŒ–ï¼‰ã‚¬ã‚¤ãƒ‰</h1>
<br>
<strong>ä½œæˆæ—¥:</strong> 2026-02-03  
<strong>å¯¾è±¡:</strong> Clawdbotè‰¦éšŠé‹ç”¨  
<strong>ç›®çš„:</strong> GUIä¸è¦ã§è‡ªå‹•å®Ÿè¡Œå¯èƒ½ãªä½œæ¥­ã®å®Ÿè£…æ–¹æ³•
<br>
---
<br>
<h2>1. Claude Code/Clawdbotã®headlessãƒ¢ãƒ¼ãƒ‰æ´»ç”¨</h2>
<br>
<h3>1.1 Claude CLI headlessãƒ¢ãƒ¼ãƒ‰</h3>
<br>
<code></code>`bash
<h1>ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°JSONå‡ºåŠ›ã§ã®headlesså®Ÿè¡Œ</h1>
claude -p "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹" --output-format stream-json
<br>
<h1>éå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œ</h1>
claude --non-interactive -p "èª¿æŸ»ã‚¿ã‚¹ã‚¯" > result.json
<br>
<h1>ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã§ã® batchå®Ÿè¡Œ</h1>
echo "è©³ç´°ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ" | claude --stdin --output-format json
<code></code>`
<br>
<h3>1.2 CI/CDçµ±åˆä¾‹</h3>
<br>
#### GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
<code></code>`yaml
<h1>.github/workflows/daily-research.yml</h1>
name: Daily Research Task
on:
  schedule:
    - cron: '0 9 * * *'  # æ¯æ—¥9:00ã«å®Ÿè¡Œ
  workflow_dispatch:
<br>
jobs:
  research:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Claude CLI
        run: |
          npm install -g claude-cli
          echo "${{ secrets.ANTHROPIC_API_KEY }}" > ~/.anthropic
      
      - name: Execute Research
        run: |
          claude -p "ä»Šæ—¥ã®æŠ€è¡“ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª¿æŸ»ã—ã¦è¦ç´„" \
                 --output-format json > daily-research.json
      
      - name: Save Results
        uses: actions/upload-artifact@v3
        with:
          name: research-results
          path: daily-research.json
<code></code>`
<br>
<h3>1.3 Clawdbot Gateway headlessé‹ç”¨</h3>
<br>
ç¾åœ¨ã®è¨­å®š: <code>/Users/user/Library/LaunchAgents/com.clawdbot.gateway.plist</code>
<code></code>`xml
<!-- Headlessè‡ªå‹•èµ·å‹•è¨­å®š -->
<key>RunAtLoad</key><true/>
<key>KeepAlive</key><true/>
<br>
<!-- ãƒ­ã‚°å‡ºåŠ›è¨­å®š -->
<key>StandardOutPath</key>
<string>/Users/user/.clawdbot/logs/gateway.log</string>
<key>StandardErrorPath</key>
<string>/Users/user/.clawdbot/logs/gateway.err.log</string>
<code></code>`
<br>
#### headlessç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
<code></code>`bash
#!/bin/bash
<h1>scripts/clawdbot-health-check.sh</h1>
<br>
GATEWAY_PORT=18789
LOG_FILE="/Users/user/.clawdbot/logs/health.log"
<br>
check_gateway() {
    if curl -s "http://localhost:$GATEWAY_PORT/status" > /dev/null; then
        echo "$(date): Gateway OK" >> "$LOG_FILE"
        return 0
    else
        echo "$(date): Gateway DOWN - Restarting..." >> "$LOG_FILE"
        launchctl unload ~/Library/LaunchAgents/com.clawdbot.gateway.plist
        launchctl load ~/Library/LaunchAgents/com.clawdbot.gateway.plist
        return 1
    fi
}
<br>
check_gateway
<code></code>`
<br>
---
<br>
<h2>2. ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–ã®headlessåŒ–</h2>
<br>
<h3>2.1 Playwright headlessè¨­å®š</h3>
<br>
#### ç¾åœ¨ã®å®Ÿè£…ï¼ˆnote_auto_post_playwright.jsï¼‰ã®æ”¹è‰¯
<code></code>`javascript
// Headlessæœ¬ç•ªç’°å¢ƒè¨­å®š
const browser = await chromium.launch({
  headless: process.env.NODE_ENV === 'production',  // ç’°å¢ƒã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆ
  args: [
    '--no-sandbox',
    '--disable-dev-shm-usage',
    '--disable-blink-features=AutomationControlled',
    '--disable-features=VizDisplayCompositor'  // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›
  ]
});
<br>
// Dockerç’°å¢ƒã§ã®è¨­å®š
const browser = await chromium.launch({
  headless: true,
  args: [
    '--no-sandbox',
    '--disable-setuid-sandbox',
    '--disable-dev-shm-usage',
    '--disable-background-timer-throttling',
    '--disable-backgrounding-occluded-windows',
    '--disable-renderer-backgrounding'
  ]
});
<code></code>`
<br>
#### å®Œå…¨headless noteæŠ•ç¨¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
<code></code>`javascript
#!/usr/bin/env node
// scripts/note-headless-post.js
<br>
const { chromium } = require('playwright');
<br>
class HeadlessNotePoster {
  constructor() {
    this.cookiePath = process.env.COOKIE_PATH || './cookies.json';
    this.headless = process.env.HEADLESS !== 'false';
  }
<br>
  async launch() {
    return await chromium.launch({
      headless: this.headless,
      args: ['--no-sandbox', '--disable-dev-shm-usage']
    });
  }
<br>
  async post(article) {
    const browser = await this.launch();
    try {
      const context = await browser.newContext({
        viewport: { width: 1280, height: 720 },
        userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'
      });
      
      // Cookieå¾©å…ƒ
      if (fs.existsSync(this.cookiePath)) {
        const cookies = JSON.parse(fs.readFileSync(this.cookiePath));
        await context.addCookies(cookies);
      }
      
      const page = await context.newPage();
      await this.performPost(page, article);
      
      // Cookieä¿å­˜
      const cookies = await context.cookies();
      fs.writeFileSync(this.cookiePath, JSON.stringify(cookies, null, 2));
      
      return true;
    } finally {
      await browser.close();
    }
  }
}
<br>
module.exports = HeadlessNotePoster;
<code></code>`
<br>
<h3>2.2 Puppeteer headlesså®Ÿè£…</h3>
<br>
<code></code>`javascript
// scripts/puppeteer-scraper.js
const puppeteer = require('puppeteer');
<br>
async function scrapeHeadless(url) {
  const browser = await puppeteer.launch({
    headless: 'new',  // æ–°ã—ã„headlessãƒ¢ãƒ¼ãƒ‰
    args: [
      '--no-sandbox',
      '--disable-setuid-sandbox',
      '--disable-gpu',
      '--window-size=1280,720'
    ]
  });
<br>
  const page = await browser.newPage();
  
  // ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹æ¤œçŸ¥å›é¿
  await page.evaluateOnNewDocument(() => {
    Object.defineProperty(navigator, 'webdriver', {
      get: () => undefined,
    });
  });
<br>
  try {
    await page.goto(url, { waitUntil: 'networkidle2' });
    const result = await page.evaluate(() => {
      return document.body.innerText;
    });
    return result;
  } finally {
    await browser.close();
  }
}
<code></code>`
<br>
---
<br>
<h2>3. å®šæœŸã‚¿ã‚¹ã‚¯ã®headlessåŒ–</h2>
<br>
<h3>3.1 macOS launchdè¨­å®š</h3>
<br>
#### æ¯æ—¥å®Ÿè¡Œã‚¿ã‚¹ã‚¯ã®è¨­å®š
<code></code>`xml
<!-- ~/Library/LaunchAgents/com.clawdbot.daily-tasks.plist -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN">
<plist version="1.0">
<dict>
  <key>Label</key>
  <string>com.clawdbot.daily-tasks</string>
  
  <key>ProgramArguments</key>
  <array>
    <string>/usr/bin/env</string>
    <string>node</string>
    <string>/Users/user/clawd/scripts/daily-automation.js</string>
  </array>
  
  <key>StartCalendarInterval</key>
  <dict>
    <key>Hour</key><integer>9</integer>
    <key>Minute</key><integer>0</integer>
  </dict>
  
  <key>StandardOutPath</key>
  <string>/Users/user/clawd/logs/daily-tasks.log</string>
  <key>StandardErrorPath</key>
  <string>/Users/user/clawd/logs/daily-tasks.err.log</string>
  
  <key>EnvironmentVariables</key>
  <dict>
    <key>PATH</key><string>/opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin</string>
    <key>NODE_ENV</key><string>production</string>
  </dict>
</dict>
</plist>
<code></code>`
<br>
#### launchdç®¡ç†ã‚³ãƒãƒ³ãƒ‰
<code></code>`bash
<h1>ã‚µãƒ¼ãƒ“ã‚¹ç™»éŒ²</h1>
launchctl load ~/Library/LaunchAgents/com.clawdbot.daily-tasks.plist
<br>
<h1>ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹</h1>
launchctl start com.clawdbot.daily-tasks
<br>
<h1>ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢</h1>
launchctl stop com.clawdbot.daily-tasks
<br>
<h1>ã‚µãƒ¼ãƒ“ã‚¹å‰Šé™¤</h1>
launchctl unload ~/Library/LaunchAgents/com.clawdbot.daily-tasks.plist
<code></code>`
<br>
<h3>3.2 cronè¨­å®šï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ‰‹æ³•ï¼‰</h3>
<br>
<code></code>`bash
<h1>crontabè¨­å®šä¾‹</h1>
<h1>æ¯æ—¥9:00ã«è¨˜äº‹æŠ•ç¨¿ãƒã‚§ãƒƒã‚¯</h1>
0 9 * * * cd /Users/user/clawd && node scripts/auto-post-check.js >> logs/cron.log 2>&1
<br>
<h1>2æ™‚é–“ã”ã¨ã«ä¾¡æ ¼ç›£è¦–</h1>
0 */2 * * * cd /Users/user/clawd && python3 price_monitor_v5.py --headless >> logs/price-monitor.log 2>&1
<br>
<h1>æ¯é€±æœˆæ›œæ—¥9:00ã«ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h1>
0 9 * * 1 cd /Users/user/clawd && node scripts/weekly-report.js >> logs/weekly.log 2>&1
<code></code>`
<br>
<h3>3.3 å®Ÿè£…ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹</h3>
<br>
#### æ—¥æ¬¡è‡ªå‹•åŒ–ã‚¿ã‚¹ã‚¯
<code></code>`javascript
// scripts/daily-automation.js
const fs = require('fs');
const path = require('path');
const { exec } = require('child_process');
<br>
class DailyAutomation {
  constructor() {
    this.logPath = '/Users/user/clawd/logs/daily-automation.log';
    this.tasksConfig = './config/daily-tasks.json';
  }
<br>
  log(message) {
    const timestamp = new Date().toISOString();
    const logEntry = `${timestamp}: ${message}\n`;
    fs.appendFileSync(this.logPath, logEntry);
    console.log(message);
  }
<br>
  async runTask(taskName, command) {
    return new Promise((resolve, reject) => {
      this.log(<code>[${taskName}] é–‹å§‹: ${command}</code>);
      
      exec(command, { cwd: '/Users/user/clawd' }, (error, stdout, stderr) => {
        if (error) {
          this.log(<code>[${taskName}] ã‚¨ãƒ©ãƒ¼: ${error.message}</code>);
          reject(error);
        } else {
          this.log(<code>[${taskName}] å®Œäº†: ${stdout.trim()}</code>);
          resolve(stdout);
        }
      });
    });
  }
<br>
  async execute() {
    const tasks = [
      {
        name: 'price-check',
        command: 'python3 price_monitor_v5.py --headless --quiet'
      },
      {
        name: 'article-queue',
        command: 'node note_auto_post_playwright.js --check-only'
      },
      {
        name: 'memory-update',
        command: 'node scripts/update-memory.js'
      }
    ];
<br>
    this.log('=== æ—¥æ¬¡è‡ªå‹•åŒ–ã‚¿ã‚¹ã‚¯é–‹å§‹ ===');
    
    for (const task of tasks) {
      try {
        await this.runTask(task.name, task.command);
      } catch (error) {
        this.log(<code>[${task.name}] ã‚¿ã‚¹ã‚¯å¤±æ•—: ${error.message}</code>);
      }
    }
    
    this.log('=== æ—¥æ¬¡è‡ªå‹•åŒ–ã‚¿ã‚¹ã‚¯å®Œäº† ===');
  }
}
<br>
if (require.main === module) {
  const automation = new DailyAutomation();
  automation.execute().catch(console.error);
}
<code></code>`
<br>
---
<br>
<h2>4. é€šçŸ¥ã®headlessåŒ–</h2>
<br>
<h3>4.1 Telegram Bot APIçµ±åˆ</h3>
<br>
#### Botè¨­å®šã¨Tokenå–å¾—
<code></code>`bash
<h1>1. @BotFatherã§Botä½œæˆ</h1>
<h1>2. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š</h1>
export TELEGRAM_BOT_TOKEN="your_bot_token"
export TELEGRAM_CHAT_ID="your_chat_id"
<code></code>`
<br>
#### Telegramé€šçŸ¥ã‚¯ãƒ©ã‚¹
<code></code>`javascript
// lib/telegram-notifier.js
const https = require('https');
<br>
class TelegramNotifier {
  constructor(token, chatId) {
    this.token = token;
    this.chatId = chatId;
    this.apiUrl = <code>https://api.telegram.org/bot${token}</code>;
  }
<br>
  async sendMessage(text, options = {}) {
    const payload = {
      chat_id: this.chatId,
      text: text,
      parse_mode: options.parseMode || 'Markdown',
      disable_web_page_preview: options.disablePreview || true
    };
<br>
    return new Promise((resolve, reject) => {
      const data = JSON.stringify(payload);
      const requestOptions = {
        hostname: 'api.telegram.org',
        path: <code>/bot${this.token}/sendMessage</code>,
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Content-Length': Buffer.byteLength(data)
        }
      };
<br>
      const req = https.request(requestOptions, (res) => {
        let body = '';
        res.on('data', chunk => body += chunk);
        res.on('end', () => {
          if (res.statusCode === 200) {
            resolve(JSON.parse(body));
          } else {
            reject(new Error(<code>HTTP ${res.statusCode}: ${body}</code>));
          }
        });
      });
<br>
      req.on('error', reject);
      req.write(data);
      req.end();
    });
  }
<br>
  async sendDocument(filePath, caption = '') {
    // ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ã®å®Ÿè£…
    const FormData = require('form-data');
    const form = new FormData();
    form.append('chat_id', this.chatId);
    form.append('document', fs.createReadStream(filePath));
    if (caption) form.append('caption', caption);
    
    // å®Ÿè£…è©³ç´°...
  }
<br>
  // ç·Šæ€¥é€šçŸ¥ï¼ˆéŸ³ä»˜ãï¼‰
  async sendAlert(text) {
    return this.sendMessage(`ğŸš¨ *ALERT*\n\n${text}`, {
      parseMode: 'Markdown',
      disableNotification: false  // é€šçŸ¥éŸ³ON
    });
  }
<br>
  // å®šæœŸãƒ¬ãƒãƒ¼ãƒˆï¼ˆéŸ³ç„¡ã—ï¼‰
  async sendReport(text) {
    return this.sendMessage(`ğŸ“Š *Report*\n\n${text}`, {
      parseMode: 'Markdown',
      disableNotification: true  // é€šçŸ¥éŸ³OFF
    });
  }
}
<br>
module.exports = TelegramNotifier;
<code></code>`
<br>
<h3>4.2 Webhooké€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ </h3>
<br>
#### Generic Webhook Notifier
<code></code>`javascript
// lib/webhook-notifier.js
const https = require('https');
const crypto = require('crypto');
<br>
class WebhookNotifier {
  constructor(config) {
    this.webhooks = config.webhooks || [];
    this.secret = config.secret;
  }
<br>
  generateSignature(payload, secret) {
    return crypto
      .createHmac('sha256', secret)
      .update(payload)
      .digest('hex');
  }
<br>
  async notify(event, data) {
    const payload = JSON.stringify({
      timestamp: new Date().toISOString(),
      event: event,
      data: data,
      source: 'clawdbot-headless'
    });
<br>
    const promises = this.webhooks.map(webhook => 
      this.sendWebhook(webhook, payload)
    );
<br>
    return Promise.allSettled(promises);
  }
<br>
  async sendWebhook(webhookUrl, payload) {
    const url = new URL(webhookUrl);
    const headers = {
      'Content-Type': 'application/json',
      'User-Agent': 'Clawdbot-Webhook/1.0'
    };
<br>
    if (this.secret) {
      headers['X-Hub-Signature-256'] = 'sha256=' + this.generateSignature(payload, this.secret);
    }
<br>
    return new Promise((resolve, reject) => {
      const req = https.request({
        hostname: url.hostname,
        port: url.port,
        path: url.pathname + url.search,
        method: 'POST',
        headers: headers
      }, (res) => {
        resolve({ status: res.statusCode, webhook: webhookUrl });
      });
<br>
      req.on('error', reject);
      req.write(payload);
      req.end();
    });
  }
}
<br>
module.exports = WebhookNotifier;
<code></code>`
<br>
---
<br>
<h2>5. èªè¨¼ã®headlessåŒ–</h2>
<br>
<h3>5.1 OAuth Device Flowå®Ÿè£…</h3>
<br>
<code></code>`javascript
// lib/oauth-device-flow.js
const https = require('https');
const fs = require('fs');
<br>
class OAuthDeviceFlow {
  constructor(clientId, clientSecret, authUrl, tokenUrl) {
    this.clientId = clientId;
    this.clientSecret = clientSecret;
    this.authUrl = authUrl;
    this.tokenUrl = tokenUrl;
    this.tokenPath = './tokens.json';
  }
<br>
  // Step 1: ãƒ‡ãƒã‚¤ã‚¹èªè¨¼ã‚³ãƒ¼ãƒ‰å–å¾—
  async requestDeviceCode() {
    const params = new URLSearchParams({
      client_id: this.clientId,
      scope: 'read write'
    });
<br>
    const response = await this.makeRequest(this.authUrl + '/device', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params.toString()
    });
<br>
    return response;
  }
<br>
  // Step 2: ãƒãƒ¼ãƒªãƒ³ã‚°ã§ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
  async pollForToken(deviceCode, interval = 5) {
    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼å®Œäº†ã¾ã§å¾…æ©Ÿä¸­...');
    
    while (true) {
      await new Promise(resolve => setTimeout(resolve, interval * 1000));
      
      try {
        const token = await this.requestToken(deviceCode);
        this.saveTokens(token);
        console.log('èªè¨¼å®Œäº†ï¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
        return token;
      } catch (error) {
        if (error.message.includes('authorization_pending')) {
          continue; // ã¾ã èªè¨¼ã•ã‚Œã¦ã„ãªã„
        } else {
          throw error;
        }
      }
    }
  }
<br>
  async requestToken(deviceCode) {
    const params = new URLSearchParams({
      grant_type: 'urn:ietf:params:oauth:grant-type:device_code',
      device_code: deviceCode,
      client_id: this.clientId,
      client_secret: this.clientSecret
    });
<br>
    return this.makeRequest(this.tokenUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params.toString()
    });
  }
<br>
  // ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
  async refreshToken() {
    const tokens = this.loadTokens();
    if (!tokens.refresh_token) {
      throw new Error('ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“');
    }
<br>
    const params = new URLSearchParams({
      grant_type: 'refresh_token',
      refresh_token: tokens.refresh_token,
      client_id: this.clientId,
      client_secret: this.clientSecret
    });
<br>
    const newTokens = await this.makeRequest(this.tokenUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: params.toString()
    });
<br>
    this.saveTokens(newTokens);
    return newTokens;
  }
<br>
  saveTokens(tokens) {
    fs.writeFileSync(this.tokenPath, JSON.stringify(tokens, null, 2));
  }
<br>
  loadTokens() {
    if (fs.existsSync(this.tokenPath)) {
      return JSON.parse(fs.readFileSync(this.tokenPath));
    }
    return null;
  }
<br>
  async makeRequest(url, options) {
    // HTTPS requestå®Ÿè£…...
  }
}
<code></code>`
<br>
<h3>5.2 APIãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†</h3>
<br>
<code></code>`javascript
// lib/token-manager.js
const fs = require('fs');
const crypto = require('crypto');
<br>
class TokenManager {
  constructor(configPath = './config/tokens.encrypted') {
    this.configPath = configPath;
    this.encryptionKey = process.env.TOKEN_ENCRYPTION_KEY || this.generateKey();
  }
<br>
  generateKey() {
    return crypto.randomBytes(32).toString('hex');
  }
<br>
  encrypt(text) {
    const cipher = crypto.createCipher('aes-256-cbc', this.encryptionKey);
    let encrypted = cipher.update(text, 'utf8', 'hex');
    encrypted += cipher.final('hex');
    return encrypted;
  }
<br>
  decrypt(encryptedText) {
    const decipher = crypto.createDecipher('aes-256-cbc', this.encryptionKey);
    let decrypted = decipher.update(encryptedText, 'hex', 'utf8');
    decrypted += decipher.final('utf8');
    return decrypted;
  }
<br>
  saveToken(serviceName, token) {
    let tokens = {};
    if (fs.existsSync(this.configPath)) {
      tokens = JSON.parse(this.decrypt(fs.readFileSync(this.configPath, 'utf8')));
    }
    
    tokens[serviceName] = {
      token: token,
      createdAt: new Date().toISOString(),
      expiresAt: token.expires_at || null
    };
<br>
    const encrypted = this.encrypt(JSON.stringify(tokens, null, 2));
    fs.writeFileSync(this.configPath, encrypted);
  }
<br>
  getToken(serviceName) {
    if (!fs.existsSync(this.configPath)) {
      return null;
    }
<br>
    const tokens = JSON.parse(this.decrypt(fs.readFileSync(this.configPath, 'utf8')));
    return tokens[serviceName] || null;
  }
<br>
  isTokenValid(serviceName) {
    const tokenData = this.getToken(serviceName);
    if (!tokenData) return false;
    
    if (tokenData.expiresAt) {
      return new Date() < new Date(tokenData.expiresAt);
    }
    
    return true; // æœŸé™ãªã—ãƒˆãƒ¼ã‚¯ãƒ³
  }
}
<br>
module.exports = TokenManager;
<code></code>`
<br>
---
<br>
<h2>6. ç¾åœ¨ã®è‰¦éšŠé‹ç”¨ã§headlessåŒ–ã§ãã‚‹ä½œæ¥­</h2>
<br>
<h3>6.1 å³åº§ã«headlessåŒ–å¯èƒ½ãªä½œæ¥­</h3>
<br>
#### A. ä¾¡æ ¼ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
<strong>ç¾åœ¨:</strong> <code>price_monitor_v5.py</code>  
<strong>headlessåŒ–æ–¹æ³•:</strong>
<code></code>`bash
<h1>cronè¨­å®š</h1>
0 */2 * * * cd /Users/user/clawd && python3 price_monitor_v5.py --headless --notify-telegram
<code></code>`
<br>
#### B. note.comè‡ªå‹•æŠ•ç¨¿
<strong>ç¾åœ¨:</strong> <code>note_auto_post_playwright.js</code>  
<strong>å¿…è¦ãªå¤‰æ›´:</strong>
<code></code>`javascript
// headless: false â†’ headless: true
const browser = await chromium.launch({
  headless: process.env.NODE_ENV === 'production',
  args: ['--no-sandbox', '--disable-dev-shm-usage']
});
<code></code>`
<br>
#### C. ã‚¸ãƒ¢ãƒ†ã‚£ãƒ¼ç›£è¦–
<strong>ç¾åœ¨:</strong> <code>jmty_filter.py</code>  
<strong>å®Ÿè£…ã‚¹ã‚¯ãƒªãƒ—ãƒˆ:</strong>
<code></code>`bash
#!/bin/bash
<h1>scripts/jmty-headless.sh</h1>
cd /Users/user/clawd
python3 jmty_filter.py --headless 2>&1 | tee logs/jmty-$(date +%Y%m%d).log
<br>
<h1>Telegramé€šçŸ¥</h1>
if [ $? -eq 0 ]; then
  node scripts/telegram-notify.js "ã‚¸ãƒ¢ãƒ†ã‚£ãƒ¼ç›£è¦–å®Œäº†: $(date)"
else
  node scripts/telegram-notify.js "âš ï¸ ã‚¸ãƒ¢ãƒ†ã‚£ãƒ¼ç›£è¦–ã‚¨ãƒ©ãƒ¼: $(date)"
fi
<code></code>`
<br>
<h3>6.2 ä¸­æœŸçš„ã«headlessåŒ–ã™ã‚‹ä½œæ¥­</h3>
<br>
#### A. ãƒ¡ãƒ¢ãƒªæ›´æ–°ã‚¿ã‚¹ã‚¯
<strong>å®Ÿè£…ä¾‹:</strong>
<code></code>`javascript
// scripts/memory-automation.js
const fs = require('fs');
const path = require('path');
<br>
class MemoryAutomation {
  constructor() {
    this.memoryDir = '/Users/user/clawd/memory';
    this.mainMemoryFile = '/Users/user/clawd/MEMORY.md';
  }
<br>
  async consolidateDailyMemories() {
    const today = new Date();
    const threeDaysAgo = new Date(today);
    threeDaysAgo.setDate(today.getDate() - 3);
<br>
    const dailyFiles = fs.readdirSync(this.memoryDir)
      .filter(file => file.match(/^\d{4}-\d{2}-\d{2}\.md$/))
      .filter(file => {
        const fileDate = new Date(file.split('.')[0]);
        return fileDate < threeDaysAgo;
      });
<br>
    // é‡è¦ãªæƒ…å ±ã‚’æŠ½å‡ºã—ã¦MEMORY.mdã«çµ±åˆ
    for (const file of dailyFiles) {
      await this.processDaily(path.join(this.memoryDir, file));
    }
  }
<br>
  async processDaily(filePath) {
    const content = fs.readFileSync(filePath, 'utf-8');
    const importantSections = this.extractImportant(content);
    
    if (importantSections.length > 0) {
      this.appendToMainMemory(importantSections, path.basename(filePath));
    }
  }
}
<code></code>`
<br>
#### B. ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
<code></code>`javascript
// scripts/daily-report.js
const TelegramNotifier = require('../lib/telegram-notifier');
<br>
async function generateDailyReport() {
  const report = {
    date: new Date().toISOString().split('T')[0],
    tasks: await getCompletedTasks(),
    metrics: await getMetrics(),
    alerts: await getAlerts()
  };
<br>
  const message = formatReport(report);
  
  const telegram = new TelegramNotifier(
    process.env.TELEGRAM_BOT_TOKEN,
    process.env.TELEGRAM_CHAT_ID
  );
  
  await telegram.sendReport(message);
}
<code></code>`
<br>
<h3>6.3 headlessåŒ–å®Ÿè£…ã®å„ªå…ˆé †ä½</h3>
<br>
#### æœ€å„ªå…ˆï¼ˆå³åº§ã«å®Ÿè£…ï¼‰
1. <strong>ä¾¡æ ¼ç›£è¦–ã®cronåŒ–</strong> - 2æ™‚é–“ã”ã¨ã®è‡ªå‹•å®Ÿè¡Œ
2. <strong>noteæŠ•ç¨¿ã®headlessåŒ–</strong> - GUIä¸è¦ã§ã®è¨˜äº‹æŠ•ç¨¿
3. <strong>Clawdbot Gatewayç›£è¦–</strong> - è‡ªå‹•å†èµ·å‹•æ©Ÿèƒ½
<br>
#### é«˜å„ªå…ˆï¼ˆ1é€±é–“ä»¥å†…ï¼‰
1. <strong>Telegramé€šçŸ¥çµ±åˆ</strong> - å…¨ã‚¿ã‚¹ã‚¯ã®çµæœé€šçŸ¥
2. <strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–</strong> - å¤±æ•—æ™‚ã®è‡ªå‹•å¾©æ—§
3. <strong>ãƒ­ã‚°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </strong> - çµ±ä¸€ã•ã‚ŒãŸãƒ­ã‚°å‡ºåŠ›
<br>
#### ä¸­å„ªå…ˆï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰
1. <strong>OAuthèªè¨¼ã®è‡ªå‹•åŒ–</strong> - APIæ¥ç¶šã®è‡ªå‹•èªè¨¼
2. <strong>ãƒªã‚½ãƒ¼ã‚¹ç›£è¦–</strong> - CPU/ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–
3. <strong>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è‡ªå‹•åŒ–</strong> - é‡è¦ãƒ‡ãƒ¼ã‚¿ã®å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
<br>
---
<br>
<h2>7. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h2>
<br>
<h3>7.1 ç’°å¢ƒè¨­å®š</h3>
<li>[ ] Node.jsç’°å¢ƒï¼ˆv25.4.0ï¼‰ç¢ºèªæ¸ˆã¿</li>
<li>[ ] Playwrightä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿</li>
<li>[ ] Python3ç’°å¢ƒç¢ºèªæ¸ˆã¿</li>
<li>[ ] launchdè¨­å®šæ¨©é™ç¢ºèªæ¸ˆã¿</li>
<br>
<h3>7.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h3>
<li>[ ] APIãƒˆãƒ¼ã‚¯ãƒ³ã®æš—å·åŒ–ä¿å­˜</li>
<li>[ ] Cookieæƒ…å ±ã®å®‰å…¨ãªç®¡ç†</li>
<li>[ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™è¨­å®š</li>
<li>[ ] èªè¨¼æƒ…å ±ã®ç’°å¢ƒå¤‰æ•°åŒ–</li>
<br>
<h3>7.3 ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ</h3>
<li>[ ] Telegram Botè¨­å®šå®Œäº†</li>
<li>[ ] ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰</li>
<li>[ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…</li>
<li>[ ] ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š</li>
<br>
<h3>7.4 ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤</h3>
<li>[ ] headlessãƒ¢ãƒ¼ãƒ‰ã§ã®å‹•ä½œç¢ºèª</li>
<li>[ ] cron/launchdã§ã®å®Ÿè¡Œãƒ†ã‚¹ãƒˆ</li>
<li>[ ] å¤±æ•—ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ</li>
<li>[ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã®ç¢ºç«‹</li>
<br>
---
<br>
<h2>8. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
<br>
<h3>8.1 ã‚ˆãã‚ã‚‹å•é¡Œ</h3>
<br>
#### Playwright headlessã§èªè¨¼å¤±æ•—
<code></code>`javascript
// è§£æ±ºç­–ï¼šUser-Agentã¨viewportã®è¨­å®š
await context.newContext({
  viewport: { width: 1280, height: 720 },
  userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'
});
<code></code>`
<br>
#### launchdèµ·å‹•å¤±æ•—
<code></code>`bash
<h1>ãƒ‡ãƒãƒƒã‚°æ–¹æ³•</h1>
launchctl list | grep clawdbot
tail -f /Users/user/.clawdbot/logs/gateway.err.log
<br>
<h1>æ¨©é™ç¢ºèª</h1>
ls -la ~/Library/LaunchAgents/com.clawdbot.*.plist
<code></code>`
<br>
#### ãƒ¡ãƒ¢ãƒªä¸è¶³
<code></code>`bash
<h1>Node.jsãƒ¡ãƒ¢ãƒªåˆ¶é™è¨­å®š</h1>
export NODE_OPTIONS="--max-old-space-size=2048"
<code></code>`
<br>
<h3>8.2 ç·Šæ€¥æ™‚å¯¾å¿œ</h3>
<br>
<code></code>`bash
<h1>å…¨ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢</h1>
launchctl stop com.clawdbot.gateway
launchctl stop com.clawdbot.daily-tasks
<br>
<h1>æ‰‹å‹•å®Ÿè¡Œã§ãƒ†ã‚¹ãƒˆ</h1>
cd /Users/user/clawd
NODE_ENV=development node scripts/test-headless.js
<br>
<h1>ãƒ­ã‚°ç¢ºèª</h1>
tail -f logs/*.log
<code></code>`
<br>
---
<br>
<h2>9. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</h2>
<br>
<h3>9.1 ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡å‰Šæ¸›</h3>
<li>Playwright: <code>--disable-dev-shm-usage</code></li>
<li>ãƒ¡ãƒ¢ãƒªåˆ¶é™: <code>--max-old-space-size</code></li>
<li>åŒæ™‚å®Ÿè¡Œåˆ¶é™: queueç®¡ç†</li>
<br>
<h3>9.2 å®Ÿè¡Œæ™‚é–“çŸ­ç¸®</h3>
<li>Cookieå†åˆ©ç”¨ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³ã‚¹ã‚­ãƒƒãƒ—</li>
<li>å¿…è¦æœ€å°é™ã®ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿</li>
<li>ä¸¦åˆ—å‡¦ç†ã®æ´»ç”¨</li>
<br>
---
<br>
<strong>ä½œæˆè€…:</strong> AI Assistant  
<strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> 1.0  
<strong>æœ€çµ‚æ›´æ–°:</strong> 2026-02-03 04:30</body></html>
